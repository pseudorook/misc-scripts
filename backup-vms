#! /bin/bash
set -eu
source globals


#
# Backup VMs in home directory to Backup 1.
#

if ! [ -d ${backup1} ]; then
  show_error "Backup destination ${backup1} does not exist."
  exit 1
fi

show_info "Syncing VMs in ${HOME} to ${backup1}."
sudo bash -c "\
  rsync -Pradog --sparse \
    ${HOME}/.local/libvirt/images/ \
    ${backup1}/Images/KVM/ && \
  rsync -Pradog \
    ${HOME}/.VirtualBox/ \
    ${backup1}/Images/VirtualBox/"
sync
show_success "Done." && echo


#
# Backup VMs in Backup 1 to Backup 2.
#

if [ -d ${backup2} ]; then
  show_info "Syncing VMs in ${backup1} to ${backup2}."
  sudo bash -c "\
    rsync -Pradog --sparse \
      ${backup1}/Images/KVM/ \
      ${backup2}/Images/KVM/ && \
    rsync -Pradog \
      ${backup1}/Images/VirtualBox/ \
      ${backup2}/Images/VirtualBox/"
  sync
  show_success "Done." && echo
fi
