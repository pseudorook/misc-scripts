#! /bin/bash
set -eu
source globals


#
# Backup VMs in home directory to Aves.
#

if ! [ -d ${backup1} ]; then
  show_error "Backup destination ${backup1} does not exist."
  exit 1
fi

show_info "Syncing VMs in ${HOME} to Aves."
sudo bash -c "\
  rsync -Pradog --sparse \
    ${HOME}/.local/libvirt/images/ \
    ${backup1}/KVM/ && \
  rsync -Pradog \
    ${HOME}/.VirtualBox/ \
    ${backup1}/VirtualBox/"
sync
show_success "Done." && echo


#
# Backup VMs in Aves to Avian.
#

if [ -d ${backup2} ]; then
  show_info "Syncing VMs in Aves to Avian."
  sudo bash -c "\
    rsync -Pradog --sparse \
      ${backup1}/KVM/ \
      ${backup2}/KVM/ && \
    rsync -Pradog \
      ${backup1}/VirtualBox/ \
      ${backup2}/VirtualBox/"
  sync
  show_success "Done." && echo
fi
